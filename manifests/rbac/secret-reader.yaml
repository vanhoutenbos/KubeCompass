# Secret Reader Role
# Access specific secrets only (database credentials, API keys)
---
apiVersion: rbac.authorization.k8s.io/v1
kind: Role
metadata:
  name: secret-reader-database
  namespace: webshop
  labels:
    rbac.kubecompass.io/role-type: secret-reader
  annotations:
    description: "Read specific secrets for database access"
rules:
# Read ONLY specific secrets
- apiGroups: [""]
  resources: ["secrets"]
  resourceNames:
    - "postgres-credentials"
    - "redis-password"
  verbs: ["get"]

# Cannot list all secrets (prevents discovery)
# Cannot create/update/delete secrets

---
apiVersion: rbac.authorization.k8s.io/v1
kind: RoleBinding
metadata:
  name: secret-reader-database-binding
  namespace: webshop
  labels:
    rbac.kubecompass.io/role-type: secret-reader
subjects:
# Application service account
- kind: ServiceAccount
  name: backend-api
  namespace: webshop

roleRef:
  kind: Role
  name: secret-reader-database
  apiGroup: rbac.authorization.k8s.io

---
# Example: API key secret reader
apiVersion: rbac.authorization.k8s.io/v1
kind: Role
metadata:
  name: secret-reader-api-keys
  namespace: webshop
  labels:
    rbac.kubecompass.io/role-type: secret-reader
rules:
- apiGroups: [""]
  resources: ["secrets"]
  resourceNames:
    - "stripe-api-key"
    - "sendgrid-api-key"
    - "aws-s3-credentials"
  verbs: ["get"]

---
apiVersion: rbac.authorization.k8s.io/v1
kind: RoleBinding
metadata:
  name: secret-reader-api-keys-binding
  namespace: webshop
subjects:
- kind: ServiceAccount
  name: payment-service
  namespace: webshop

roleRef:
  kind: Role
  name: secret-reader-api-keys
  apiGroup: rbac.authorization.k8s.io
